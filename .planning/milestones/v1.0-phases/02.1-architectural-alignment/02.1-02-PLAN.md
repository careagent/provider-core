---
phase: 02.1-architectural-alignment
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hardening/types.ts
  - src/hardening/engine.ts
  - src/hardening/index.ts
  - src/credentials/types.ts
  - src/credentials/validator.ts
  - src/credentials/index.ts
  - src/neuron/types.ts
  - src/neuron/client.ts
  - src/neuron/index.ts
  - src/protocol/types.ts
  - src/protocol/server.ts
  - src/protocol/index.ts
  - test/unit/hardening/hardening.test.ts
  - test/unit/credentials/credentials.test.ts
  - test/unit/neuron/neuron.test.ts
  - test/unit/protocol/protocol.test.ts
autonomous: true

must_haves:
  truths:
    - "src/hardening/ directory exists with types, engine, and index"
    - "src/credentials/ directory exists with types, validator, and index"
    - "src/neuron/ directory exists with types, client, and index"
    - "src/protocol/ directory exists with types, server, and index"
    - "Each stub module's factory function throws 'not yet implemented' with the target phase"
    - "Each stub module's types import from existing canonical modules (no circular deps)"
    - "All 388+ existing tests still pass plus new stub tests"
  artifacts:
    - path: "src/hardening/types.ts"
      provides: "HardeningEngine, HardeningLayerResult, HardeningConfig interfaces"
      contains: "interface HardeningEngine"
    - path: "src/hardening/engine.ts"
      provides: "createHardeningEngine factory stub"
      contains: "not yet implemented"
    - path: "src/hardening/index.ts"
      provides: "Re-exports from types and engine"
      contains: "from './types.js'"
    - path: "src/credentials/types.ts"
      provides: "CredentialValidator, CredentialCheckResult interfaces"
      contains: "interface CredentialValidator"
    - path: "src/credentials/validator.ts"
      provides: "createCredentialValidator factory stub"
      contains: "not yet implemented"
    - path: "src/credentials/index.ts"
      provides: "Re-exports from types and validator"
      contains: "from './types.js'"
    - path: "src/neuron/types.ts"
      provides: "NeuronClient, NeuronRegistration interfaces"
      contains: "interface NeuronClient"
    - path: "src/neuron/client.ts"
      provides: "createNeuronClient factory stub"
      contains: "not yet implemented"
    - path: "src/neuron/index.ts"
      provides: "Re-exports from types and client"
      contains: "from './types.js'"
    - path: "src/protocol/types.ts"
      provides: "ProtocolServer, ProtocolSession interfaces"
      contains: "interface ProtocolServer"
    - path: "src/protocol/index.ts"
      provides: "Re-exports from types and server"
      contains: "from './types.js'"
  key_links:
    - from: "src/hardening/types.ts"
      to: "src/activation/cans-schema.ts"
      via: "import type CANSDocument"
      pattern: "from '../activation/cans-schema\\.js'"
    - from: "src/hardening/types.ts"
      to: "src/adapters/types.ts"
      via: "import type PlatformAdapter"
      pattern: "from '../adapters/types\\.js'"
    - from: "src/hardening/types.ts"
      to: "src/audit/pipeline.ts"
      via: "import type AuditPipeline"
      pattern: "from '../audit/pipeline\\.js'"
    - from: "src/credentials/types.ts"
      to: "src/activation/cans-schema.ts"
      via: "import type CANSDocument"
      pattern: "from '../activation/cans-schema\\.js'"
---

<objective>
Create four stub modules (hardening, credentials, neuron, protocol) with TypeScript interfaces and placeholder factory functions.

Purpose: These modules define the contracts that Phase 3 (Hardening), Phase 4 (Clinical Skills), and Phase 5+ will implement. Creating them now aligns the codebase with the README target architecture and gives downstream phases well-defined interfaces to code against. Stubs import FROM existing modules; existing modules do NOT import from stubs (no circular dependencies).

Output: 12 new source files across 4 directories, 4 new test files verifying exports and stub behavior. All existing 388 tests unaffected.
</objective>

<execution_context>
@/Users/thomasanderson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thomasanderson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02.1-architectural-alignment/02.1-RESEARCH.md
@src/adapters/types.ts
@src/adapters/index.ts
@src/activation/cans-schema.ts
@src/audit/pipeline.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create hardening and credentials stub modules</name>
  <files>src/hardening/types.ts, src/hardening/engine.ts, src/hardening/index.ts, src/credentials/types.ts, src/credentials/validator.ts, src/credentials/index.ts, test/unit/hardening/hardening.test.ts, test/unit/credentials/credentials.test.ts</files>
  <action>
**src/hardening/types.ts:**
Define interfaces informed by HARD-01..07 requirements:
- `HardeningLayerResult` interface: `{ layer: string; allowed: boolean; reason?: string; }`
- `HardeningConfig` interface: `{ cans: CANSDocument; adapter: PlatformAdapter; audit: AuditPipeline; }` — import types from `../activation/cans-schema.js`, `../adapters/types.js`, `../audit/pipeline.js`
- `HardeningEngine` interface with methods:
  - `activate(config: HardeningConfig): void` — initialize all 6 layers
  - `check(toolName: string, params?: Record<string, unknown>): HardeningLayerResult` — check tool call against all layers
  - `injectProtocol(cans: CANSDocument): string[]` — return clinical hard rules for system prompt injection (HARD-03)

Export all types and interfaces. Use `import type` for all cross-module imports.

**src/hardening/engine.ts:**
- Export `createHardeningEngine(): HardeningEngine` factory function
- All methods throw `new Error('Hardening engine not yet implemented (Phase 3)')`

**src/hardening/index.ts:**
Re-export pattern matching `src/adapters/index.ts`:
- `export type { HardeningEngine, HardeningLayerResult, HardeningConfig } from './types.js';`
- `export { createHardeningEngine } from './engine.js';`

**src/credentials/types.ts:**
Define interfaces informed by SKIL-01 requirement:
- `CredentialCheckResult` interface: `{ valid: boolean; provider: string; licenseType: string; specialty: string; missingCredentials?: string[]; reason?: string; }`
- `CredentialValidator` interface with method:
  - `check(cans: CANSDocument, requiredCredentials: { license?: string[]; specialty?: string[]; privilege?: string[]; }): CredentialCheckResult` — validate provider credentials against skill requirements
Import `CANSDocument` from `../activation/cans-schema.js` using `import type`.

**src/credentials/validator.ts:**
- Export `createCredentialValidator(): CredentialValidator` factory function
- Method throws `new Error('Credential validator not yet implemented (Phase 4)')`

**src/credentials/index.ts:**
Re-export:
- `export type { CredentialValidator, CredentialCheckResult } from './types.js';`
- `export { createCredentialValidator } from './validator.js';`

**test/unit/hardening/hardening.test.ts:**
Tests:
- `createHardeningEngine` returns an object with `activate`, `check`, `injectProtocol` methods
- `activate()` throws with message containing "not yet implemented"
- `check()` throws with message containing "not yet implemented"
- `injectProtocol()` throws with message containing "not yet implemented"

**test/unit/credentials/credentials.test.ts:**
Tests:
- `createCredentialValidator` returns an object with `check` method
- `check()` throws with message containing "not yet implemented"

Run `npx vitest run` after creating all files.
  </action>
  <verify>`npx vitest run` passes all existing 388 tests plus new hardening and credentials tests. `npx tsc --noEmit` exits 0. No circular dependency warnings.</verify>
  <done>src/hardening/ and src/credentials/ directories exist with complete types, stub implementations, index re-exports, and passing tests. Factory functions throw "not yet implemented" errors referencing their target phase.</done>
</task>

<task type="auto">
  <name>Task 2: Create neuron and protocol stub modules</name>
  <files>src/neuron/types.ts, src/neuron/client.ts, src/neuron/index.ts, src/protocol/types.ts, src/protocol/server.ts, src/protocol/index.ts, test/unit/neuron/neuron.test.ts, test/unit/protocol/protocol.test.ts</files>
  <action>
**src/neuron/types.ts:**
Define interfaces informed by README Neuron Integration section:
- `NeuronRegistration` interface: `{ endpoint: string; registrationId?: string; providerName: string; specialty: string; }`
- `NeuronClient` interface with methods:
  - `register(config: NeuronRegistration): Promise<{ registrationId: string; status: string; }>` — register with Neuron endpoint
  - `heartbeat(): Promise<{ connected: boolean; lastSeen?: string; }>` — check Neuron connection
  - `disconnect(): Promise<void>` — cleanly disconnect from Neuron

No cross-module type imports needed (NeuronRegistration is self-contained).

**src/neuron/client.ts:**
- Export `createNeuronClient(): NeuronClient` factory function
- All methods throw `new Error('Neuron client not yet implemented (Phase 5)')`

**src/neuron/index.ts:**
Re-export:
- `export type { NeuronClient, NeuronRegistration } from './types.js';`
- `export { createNeuronClient } from './client.js';`

**src/protocol/types.ts:**
Define interfaces informed by README Cross-Installation Protocol section:
- `ProtocolSession` interface: `{ sessionId: string; patientAgentId: string; providerAgentId: string; startedAt: string; status: 'active' | 'completed' | 'terminated'; }`
- `ProtocolServer` interface with methods:
  - `start(port: number): Promise<void>` — start the inbound channel endpoint
  - `stop(): Promise<void>` — gracefully shut down
  - `activeSessions(): ProtocolSession[]` — list current sessions

No cross-module type imports needed (ProtocolSession is self-contained).

**src/protocol/server.ts:**
- Export `createProtocolServer(): ProtocolServer` factory function
- All methods throw `new Error('Protocol server not yet implemented (Phase 5)')`

**src/protocol/index.ts:**
Re-export:
- `export type { ProtocolServer, ProtocolSession } from './types.js';`
- `export { createProtocolServer } from './server.js';`

**test/unit/neuron/neuron.test.ts:**
Tests:
- `createNeuronClient` returns an object with `register`, `heartbeat`, `disconnect` methods
- `register()` throws (or rejects) with message containing "not yet implemented"
- `heartbeat()` throws (or rejects) with message containing "not yet implemented"
- `disconnect()` throws (or rejects) with message containing "not yet implemented"

**test/unit/protocol/protocol.test.ts:**
Tests:
- `createProtocolServer` returns an object with `start`, `stop`, `activeSessions` methods
- `start()` throws (or rejects) with message containing "not yet implemented"
- `activeSessions()` throws with message containing "not yet implemented"

Run `npx vitest run` after creating all files.
  </action>
  <verify>`npx vitest run` passes all existing tests plus new neuron and protocol tests. `npx tsc --noEmit` exits 0.</verify>
  <done>src/neuron/ and src/protocol/ directories exist with complete types, stub implementations, index re-exports, and passing tests. All 4 stub modules (hardening, credentials, neuron, protocol) are now in place.</done>
</task>

</tasks>

<verification>
- `ls src/hardening/ src/credentials/ src/neuron/ src/protocol/` shows types.ts, implementation file, and index.ts in each
- `ls test/unit/hardening/ test/unit/credentials/ test/unit/neuron/ test/unit/protocol/` shows test files
- `npx vitest run` passes all tests (388 existing + ~20 new stub tests)
- `npx tsc --noEmit` exits 0
- `grep -r "from '../hardening" src/activation/ src/audit/ src/adapters/ src/cli/ src/onboarding/` returns 0 results (existing modules do NOT import from stubs)
</verification>

<success_criteria>
Four stub module directories exist with interfaces derived from Phase 3-5 requirements. Factory functions throw descriptive "not yet implemented" errors. All tests pass. No circular dependencies introduced.
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-architectural-alignment/02.1-02-SUMMARY.md`
</output>
