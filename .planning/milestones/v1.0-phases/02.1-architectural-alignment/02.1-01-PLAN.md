---
phase: 02.1-architectural-alignment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/audit/integrity-service.ts
  - src/cli/commands.ts
  - test/unit/adapter/openclaw-adapter.test.ts
  - src/adapter/types.ts
  - src/adapter/openclaw-adapter.ts
  - src/types/index.ts
  - src/types/cans.ts
autonomous: true

must_haves:
  truths:
    - "No source file imports from src/adapter/ (singular)"
    - "No source file imports from src/types/"
    - "The src/adapter/ directory no longer exists"
    - "The src/types/ directory no longer exists"
    - "All 388+ existing tests still pass"
  artifacts:
    - path: "src/audit/integrity-service.ts"
      provides: "ServiceConfig import from adapters/types.js (not adapter/types.js)"
      contains: "from '../adapters/types.js'"
    - path: "src/cli/commands.ts"
      provides: "PlatformAdapter import from adapters/types.js (not adapter/types.js)"
      contains: "from '../adapters/types.js'"
    - path: "test/unit/adapters/openclaw/openclaw-adapter.test.ts"
      provides: "Adapter test moved from test/unit/adapter/ to test/unit/adapters/openclaw/"
      contains: "from '../../../../src/adapters/openclaw/index.js'"
  key_links:
    - from: "src/audit/integrity-service.ts"
      to: "src/adapters/types.ts"
      via: "direct import of ServiceConfig"
      pattern: "from '../adapters/types\\.js'"
    - from: "src/cli/commands.ts"
      to: "src/adapters/types.ts"
      via: "direct import of PlatformAdapter"
      pattern: "from '../adapters/types\\.js'"
---

<objective>
Fix stale imports pointing at deprecated shim directories and remove the shim directories entirely.

Purpose: Eliminate src/adapter/ (singular) and src/types/ backward-compatibility shims. These were kept during the PORT reorganization for safety but are now only referenced by 2 source files and 1 test file. Removing them cleans the codebase and prevents future confusion between adapter/ and adapters/.

Output: Two deleted directories, three updated import paths, one relocated test file. All 388 tests still passing.
</objective>

<execution_context>
@/Users/thomasanderson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thomasanderson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02.1-architectural-alignment/02.1-RESEARCH.md
@src/adapters/types.ts
@src/adapter/types.ts
@src/adapter/openclaw-adapter.ts
@src/types/index.ts
@src/types/cans.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix stale imports in source and test files</name>
  <files>src/audit/integrity-service.ts, src/cli/commands.ts, test/unit/adapter/openclaw-adapter.test.ts</files>
  <action>
1. In `src/audit/integrity-service.ts` line 13, change:
   `import type { ServiceConfig } from '../adapter/types.js';`
   to:
   `import type { ServiceConfig } from '../adapters/types.js';`

2. In `src/cli/commands.ts` line 1, change:
   `import type { CareAgentPluginAPI } from '../adapter/types.js';`
   to:
   `import type { PlatformAdapter } from '../adapters/types.js';`
   Also update the function signature on line 8 from `adapter: CareAgentPluginAPI` to `adapter: PlatformAdapter`. (PlatformAdapter is the canonical name; CareAgentPluginAPI is the deprecated alias. Both are exported from adapters/types.ts, but new code should use the canonical name.)

3. Move `test/unit/adapter/openclaw-adapter.test.ts` to `test/unit/adapters/openclaw/openclaw-adapter.test.ts` (create the `test/unit/adapters/openclaw/` directory). Update its import on line 2 from:
   `import { createAdapter } from '../../../src/adapter/openclaw-adapter.js';`
   to:
   `import { createAdapter } from '../../../../src/adapters/openclaw/index.js';`

4. Run `npx vitest run` to confirm all 388 tests pass after these changes.
  </action>
  <verify>`npx vitest run` reports 388 passed, 0 failed. `grep -r "from.*adapter/types" src/` returns no results. `grep -r "from.*adapter/openclaw" test/` returns no results.</verify>
  <done>All three stale import paths are updated to canonical locations. Test file is relocated to mirror source structure. All 388 tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Remove deprecated shim directories</name>
  <files>src/adapter/types.ts, src/adapter/openclaw-adapter.ts, src/types/index.ts, src/types/cans.ts</files>
  <action>
1. Verify no remaining imports from `src/adapter/` in source or test files:
   `grep -r "from.*['\"].*adapter/" src/ test/` should return NO results pointing to `src/adapter/` (results pointing to `src/adapters/` are expected and fine).

2. Verify no remaining imports from `src/types/` in source or test files:
   `grep -r "from.*['\"].*types/" src/ test/` should return NO results pointing to `src/types/`.

3. Delete the `src/adapter/` directory entirely (both `types.ts` and `openclaw-adapter.ts`).

4. Delete the `src/types/` directory entirely (both `index.ts` and `cans.ts`).

5. Delete the now-empty `test/unit/adapter/` directory.

6. Run `npx tsc --noEmit` to verify TypeScript compilation succeeds with no errors.

7. Run `npx vitest run` to confirm all 388 tests still pass.

8. Run `pnpm build` to confirm all 4 entry points build successfully.
  </action>
  <verify>`npx vitest run` reports 388 passed. `npx tsc --noEmit` exits 0. `pnpm build` succeeds. `ls src/adapter/ 2>/dev/null` returns error (directory gone). `ls src/types/ 2>/dev/null` returns error (directory gone). `ls test/unit/adapter/ 2>/dev/null` returns error (directory gone).</verify>
  <done>Both shim directories (src/adapter/, src/types/) and the old test directory (test/unit/adapter/) are deleted. Build, typecheck, and all 388 tests pass. No remaining imports reference the deleted paths.</done>
</task>

</tasks>

<verification>
- `grep -r "from.*'/adapter/" src/ test/` returns 0 results
- `grep -r "from.*'/types/" src/ test/` returns 0 results
- `ls src/adapter/ 2>/dev/null` fails (directory deleted)
- `ls src/types/ 2>/dev/null` fails (directory deleted)
- `npx vitest run` passes 388 tests
- `pnpm build` succeeds
</verification>

<success_criteria>
All deprecated shim directories are removed, all imports point to canonical locations, 388 tests pass, build succeeds, typecheck passes.
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-architectural-alignment/02.1-01-SUMMARY.md`
</output>
