---
phase: 02.1-architectural-alignment
plan: 04
type: execute
wave: 2
depends_on: ["02.1-01", "02.1-02", "02.1-03"]
files_modified:
  - src/entry/core.ts
  - README.md
autonomous: true

must_haves:
  truths:
    - "entry/core.ts re-exports types from all four new stub modules"
    - "README Repository Structure section lists all actual directories (adapters, cli, entry, vendor) alongside stub directories (hardening, credentials, neuron, protocol)"
    - "README clearly marks which modules are implemented vs stub/interface-only"
    - "Build succeeds with all entry points"
    - "All tests pass"
  artifacts:
    - path: "src/entry/core.ts"
      provides: "Re-exports of HardeningEngine, CredentialValidator, NeuronClient, ProtocolServer types and factories"
      contains: "from '../hardening/index.js'"
    - path: "README.md"
      provides: "Updated Repository Structure section reflecting actual codebase"
      contains: "adapters/"
  key_links:
    - from: "src/entry/core.ts"
      to: "src/hardening/index.ts"
      via: "type re-export"
      pattern: "from '../hardening"
    - from: "src/entry/core.ts"
      to: "src/credentials/index.ts"
      via: "type re-export"
      pattern: "from '../credentials"
    - from: "src/entry/core.ts"
      to: "src/neuron/index.ts"
      via: "type re-export"
      pattern: "from '../neuron"
    - from: "src/entry/core.ts"
      to: "src/protocol/index.ts"
      via: "type re-export"
      pattern: "from '../protocol"
---

<objective>
Update the core entry point to re-export new stub module types and update the README to reflect the actual codebase structure.

Purpose: The core entry point (`src/entry/core.ts`) is the stable import surface for consumers who need types without platform-specific registration. Adding stub module re-exports means downstream code can `import type { HardeningEngine } from '@careagent/provider-core/core'`. The README update documents the proven architecture (adapters/, cli/, entry/, vendor/) that was built in Phases 1-2 but never added to the Repository Structure section, and clearly marks stub modules.

Output: Updated core.ts with new re-exports, updated README with accurate directory listing. Build succeeds. All tests pass.
</objective>

<execution_context>
@/Users/thomasanderson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thomasanderson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02.1-architectural-alignment/02.1-RESEARCH.md
@src/entry/core.ts
@README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update entry/core.ts with stub module re-exports</name>
  <files>src/entry/core.ts</files>
  <action>
Add re-exports from the four new stub modules to `src/entry/core.ts`, following the existing pattern. Append these sections AFTER the existing "Workspace profiles" section:

```typescript
// Hardening (interface-only — implementation in Phase 3)
export type { HardeningEngine, HardeningLayerResult, HardeningConfig } from '../hardening/index.js';
export { createHardeningEngine } from '../hardening/index.js';

// Credentials (interface-only — implementation in Phase 4)
export type { CredentialValidator, CredentialCheckResult } from '../credentials/index.js';
export { createCredentialValidator } from '../credentials/index.js';

// Neuron (interface-only — implementation in Phase 5)
export type { NeuronClient, NeuronRegistration } from '../neuron/index.js';
export { createNeuronClient } from '../neuron/index.js';

// Protocol (interface-only — implementation in Phase 5)
export type { ProtocolServer, ProtocolSession } from '../protocol/index.js';
export { createProtocolServer } from '../protocol/index.js';
```

Also add re-exports of the new CANS schema types:

```typescript
// CANS schema extensions
export type {
  NeuronConfig,
  SkillGatingRule,
  SkillGating,
  CrossInstallationConsent,
} from '../activation/cans-schema.js';
```

Run `pnpm build` to verify all 4 entry points build. Run `npx tsc --noEmit` to verify typecheck. Run `npx vitest run` to verify all tests pass.
  </action>
  <verify>`pnpm build` succeeds. `npx tsc --noEmit` exits 0. `npx vitest run` passes all tests. The built `dist/entry/core.d.ts` includes the new type exports.</verify>
  <done>entry/core.ts re-exports all new stub module types and factories plus new CANS schema types. The @careagent/provider-core/core import path provides a complete type surface for all modules.</done>
</task>

<task type="auto">
  <name>Task 2: Update README Repository Structure and stub annotations</name>
  <files>README.md</files>
  <action>
Update the "Repository Structure" section of README.md (currently at line ~286) to reflect the actual codebase structure. Replace the current structure block with:

```
careagent/provider-core/
├── src/
│   ├── index.ts              # Plugin entry point — register(api)
│   ├── activation/           # CANS.md parsing, validation, activation logic
│   ├── adapters/             # Multi-platform adapter layer (OpenClaw, standalone)
│   ├── audit/                # AUDIT.log append-only logging
│   ├── cli/                  # CLI commands (careagent init, careagent status)
│   ├── credentials/          # Credential validation against CANS.md [stub — Phase 4]
│   ├── entry/                # Platform-specific entry points (openclaw, standalone, core)
│   ├── hardening/            # Six-layer hardening implementation [stub — Phase 3]
│   ├── neuron/               # Neuron registration and communication [stub — Phase 5]
│   ├── onboarding/           # careagent init interview and CANS generation
│   ├── protocol/             # Cross-installation channel, server role [stub — Phase 5]
│   └── vendor/               # Vendored dependencies (yaml)
├── test/                     # Unit, integration, and smoke tests
├── openclaw.plugin.json      # Plugin manifest
└── package.json              # pnpm package — OpenClaw as optional peer dependency
```

Key changes from the old listing:
1. ADD: `adapters/`, `cli/`, `entry/`, `vendor/` (exist but were missing from README)
2. ANNOTATE: `credentials/`, `hardening/`, `neuron/`, `protocol/` with `[stub -- Phase N]` markers
3. REMOVE: `skills/` and `templates/` directories (do not exist; they belong in the provider-skills repo)
4. REMOVE: `docs/` directory (does not exist yet; Phase 6)
5. UPDATE: `package.json` description to mention optional peer dependency
6. UPDATE: `test/` with brief description

Do NOT change any other section of the README. Only the Repository Structure block.

Run `pnpm build` as a final sanity check.
  </action>
  <verify>The README Repository Structure section lists all 11 src/ subdirectories. No directory is listed that does not exist. Stub modules are clearly marked with `[stub -- Phase N]`. `pnpm build` still succeeds.</verify>
  <done>README accurately reflects the codebase structure. Proven directories (adapters, cli, entry, vendor) are documented. Stub modules are clearly annotated so readers know they are interface-only.</done>
</task>

<task type="auto">
  <name>Task 3: Final phase verification</name>
  <files></files>
  <action>
Run the complete verification suite to confirm the entire phase is successful:

1. `npx tsc --noEmit` — TypeScript compilation clean
2. `npx vitest run` — all tests pass (original 388 + new stub tests + new schema tests)
3. `pnpm build` — all 4 entry points build successfully
4. Verify no imports reference deleted directories:
   - `grep -r "from.*'/adapter/" src/ test/` returns 0 results
   - `grep -r "from.*'/types/" src/ test/` returns 0 results
5. Verify no circular dependencies (existing modules should NOT import from stubs):
   - `grep -r "from.*hardening" src/activation/ src/audit/ src/adapters/ src/cli/ src/onboarding/` returns 0 results
   - `grep -r "from.*credentials" src/activation/ src/audit/ src/adapters/ src/cli/ src/onboarding/` returns 0 results
   - `grep -r "from.*neuron" src/activation/ src/audit/ src/adapters/ src/cli/ src/onboarding/` returns 0 results (except cans-schema which defines NeuronConfigSchema)
   - `grep -r "from.*protocol" src/activation/ src/audit/ src/adapters/ src/cli/ src/onboarding/` returns 0 results
6. Verify directory structure:
   - `ls src/hardening/ src/credentials/ src/neuron/ src/protocol/` shows 3 files each
   - `ls src/adapter/ 2>/dev/null` fails (deleted)
   - `ls src/types/ 2>/dev/null` fails (deleted)

Report total test count — should be 388 + ~35 new tests = ~423.
  </action>
  <verify>All 6 checks above pass. Total test count is 388+. `pnpm build` exits 0. `npx tsc --noEmit` exits 0.</verify>
  <done>Phase 02.1 is verified complete. Codebase matches README target architecture. All tests pass. Build succeeds. No stale imports. No circular dependencies.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` exits 0
- `npx vitest run` passes all tests (388 original + ~35 new)
- `pnpm build` succeeds
- README Repository Structure matches actual `ls src/` output
- entry/core.ts exports types from all 4 stub modules
- No circular dependency: existing modules do not import from stubs
- No stale imports: no references to src/adapter/ or src/types/
</verification>

<success_criteria>
Core entry point re-exports all new types. README accurately documents the codebase. Full verification passes: typecheck, tests, build, no stale imports, no circular deps. Phase 02.1 is complete.
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-architectural-alignment/02.1-04-SUMMARY.md`
</output>
